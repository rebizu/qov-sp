<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video to QOV Converter</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f0f1a;
      min-height: 100vh;
      color: #fff;
    }
    .header {
      background: rgba(0, 0, 0, 0.3);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .header a {
      color: #00d4ff;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .header h1 {
      font-size: 1.5rem;
      flex: 1;
    }
    .main {
      display: flex;
      height: calc(100vh - 60px);
    }
    .preview-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1.5rem;
      background: #0a0a12;
    }
    .canvas-wrapper {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }
    #previewCanvas {
      max-width: 100%;
      max-height: 100%;
    }
    .drop-zone {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.8);
      border: 2px dashed rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .drop-zone.hidden {
      display: none;
    }
    .drop-zone:hover,
    .drop-zone.dragover {
      background: rgba(0, 212, 255, 0.1);
      border-color: #00d4ff;
    }
    .drop-zone-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    .drop-zone-text {
      font-size: 1.2rem;
      color: #94a3b8;
      margin-bottom: 0.5rem;
    }
    .drop-zone-hint {
      font-size: 0.9rem;
      color: #64748b;
    }
    .controls {
      padding: 1rem 0;
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    button {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #convertBtn {
      background: #22c55e;
      color: white;
    }
    #convertBtn:hover:not(:disabled) {
      background: #16a34a;
    }
    #downloadBtn {
      background: #3b82f6;
      color: white;
    }
    #downloadBtn:hover:not(:disabled) {
      background: #2563eb;
    }
    .sidebar {
      width: 350px;
      background: rgba(255, 255, 255, 0.02);
      border-left: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1.5rem;
      overflow-y: auto;
    }
    .sidebar h2 {
      font-size: 0.85rem;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }
    .setting {
      margin-bottom: 1.5rem;
    }
    .setting label {
      display: block;
      font-size: 0.9rem;
      color: #e2e8f0;
      margin-bottom: 0.5rem;
    }
    .setting select,
    .setting input[type="number"],
    .setting input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      font-size: 0.9rem;
    }
    .setting.checkboxes {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      color: #e2e8f0;
    }
    .checkbox-label input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: #3b82f6;
    }
    .progress-container {
      margin-top: 1rem;
    }
    .progress-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #00d4ff);
      width: 0%;
      transition: width 0.1s;
    }
    .progress-text {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: #94a3b8;
      text-align: center;
    }
    .stats {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    .stat-row:last-child {
      border-bottom: none;
    }
    .stat-label {
      color: #94a3b8;
      font-size: 0.85rem;
    }
    .stat-value {
      color: #fff;
      font-size: 0.85rem;
      font-family: monospace;
    }
    .log-container {
      margin-top: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      padding: 0.75rem;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.75rem;
    }
    .log-entry {
      padding: 0.25rem 0;
      color: #94a3b8;
    }
    .log-entry.error {
      color: #ef4444;
    }
    .log-entry.success {
      color: #22c55e;
    }
    #fileInput {
      display: none;
    }
  </style>
</head>
<body>
  <div class="header">
    <a href="index.html">&larr; Back</a>
    <h1>Video to QOV Converter</h1>
  </div>

  <div class="main">
    <div class="preview-container">
      <div class="canvas-wrapper">
        <canvas id="previewCanvas"></canvas>
        <div class="drop-zone" id="dropZone">
          <div class="drop-zone-icon">&#127916;</div>
          <div class="drop-zone-text">Drop a video file here</div>
          <div class="drop-zone-hint">or click to browse (MP4, WebM, MPEG, etc.)</div>
        </div>
      </div>

      <div class="controls">
        <button id="convertBtn" disabled>Convert to QOV</button>
        <button id="downloadBtn" disabled>Download QOV</button>
      </div>
    </div>

    <div class="sidebar">
      <h2>Conversion Settings</h2>

      <div class="setting">
        <label for="keyframeInterval">Keyframe Interval</label>
        <select id="keyframeInterval">
          <option value="1">Every frame (all keyframes)</option>
          <option value="5">Every 5 frames</option>
          <option value="15">Every 15 frames</option>
          <option value="30" selected>Every 30 frames</option>
          <option value="60">Every 60 frames</option>
          <option value="120">Every 120 frames</option>
        </select>
      </div>

      <div class="setting">
        <label for="targetFps">Target Frame Rate</label>
        <select id="targetFps">
          <option value="0">Keep original</option>
          <option value="10">10 fps</option>
          <option value="15">15 fps</option>
          <option value="24">24 fps</option>
          <option value="25">25 fps</option>
          <option value="30" selected>30 fps</option>
          <option value="50">50 fps</option>
          <option value="60">60 fps</option>
        </select>
      </div>

      <div class="setting">
        <label for="resolution">Output Resolution</label>
        <select id="resolution">
          <option value="1">Original (100%)</option>
          <option value="0.75">75%</option>
          <option value="0.5">50%</option>
          <option value="0.25">25%</option>
          <option value="320">320p</option>
          <option value="480">480p</option>
          <option value="720">720p</option>
          <option value="1080">1080p</option>
        </select>
      </div>

      <div class="setting">
        <label for="colorspace">Colorspace</label>
        <select id="colorspace">
          <option value="0x00" selected>sRGB (default)</option>
          <option value="0x01">sRGBA (with alpha)</option>
          <option value="0x02">Linear RGB</option>
          <option value="0x03">Linear RGBA</option>
          <option value="0x10">YUV 4:2:0</option>
          <option value="0x11">YUV 4:2:2</option>
          <option value="0x12">YUV 4:4:4</option>
          <option value="0x13">YUVA 4:2:0 (with alpha)</option>
        </select>
      </div>

      <h2>Format Options</h2>
      <div class="setting checkboxes">
        <label class="checkbox-label">
          <input type="checkbox" id="compressionEnabled" checked>
          <span>LZ4 compression (smaller files)</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="flagIndex" checked>
          <span>Include seek index</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="flagAlpha">
          <span>Preserve alpha channel</span>
        </label>
      </div>

      <h2>Frame Range</h2>
      <div class="setting">
        <label for="startTime">Start Time (seconds)</label>
        <input type="number" id="startTime" value="0" min="0" step="0.1">
      </div>
      <div class="setting">
        <label for="endTime">End Time (seconds, 0 = end)</label>
        <input type="number" id="endTime" value="0" min="0" step="0.1">
      </div>

      <div class="setting">
        <label for="maxFrames">Max Frames (0 = unlimited)</label>
        <input type="number" id="maxFrames" value="0" min="0" step="1">
      </div>

      <h2>Source File Info</h2>
      <div class="stats">
        <div class="stat-row">
          <span class="stat-label">File Name</span>
          <span class="stat-value" id="statFileName">-</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">File Size</span>
          <span class="stat-value" id="statFileSize">-</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Resolution</span>
          <span class="stat-value" id="statResolution">-</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Duration</span>
          <span class="stat-value" id="statDuration">-</span>
        </div>
      </div>

      <h2>Output Preview</h2>
      <div class="stats">
        <div class="stat-row">
          <span class="stat-label">Output Resolution</span>
          <span class="stat-value" id="statOutputRes">-</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Est. Frames</span>
          <span class="stat-value" id="statEstFrames">-</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Est. Duration</span>
          <span class="stat-value" id="statEstDuration">-</span>
        </div>
      </div>

      <h2>Conversion Progress</h2>
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Ready</div>
      </div>

      <div class="stats">
        <div class="stat-row">
          <span class="stat-label">Frames Processed</span>
          <span class="stat-value" id="statFrames">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Output Size</span>
          <span class="stat-value" id="statOutputSize">0 KB</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Compression</span>
          <span class="stat-value" id="statCompression">-</span>
        </div>
      </div>

      <h2>Log</h2>
      <div class="log-container" id="logContainer"></div>
    </div>
  </div>

  <input type="file" id="fileInput" accept="video/*,.mpg,.mpeg,.ts,.m1v,.mp4,.webm,.avi,.mov,.mkv">
  <script type="module" src="/src/converter.ts"></script>
</body>
</html>
